---
layout: post
title: e2e testing in angular.js with a mocked httpBackend
date: '2012-09-12T00:07:00.000-07:00'
author: Stephen Nancekivell
tags: 
modified_time: '2013-04-14T01:02:10.201-07:00'
blogger_id: tag:blogger.com,1999:blog-2519344180739427574.post-3987132572218110779
blogger_orig_url: http://blog.stephenn.com/2012/09/e2e-testing-in-angularjs.html
---

Angular.js is a great framework used to make web apps, by manipulating the DOM and integrating with a rest backend.<br /><br />Edit:<br />You should use ngMockE2E rather than the technique described bellow. They are verry similar. ngMockE2E is the more supported. An Example of using can be found&nbsp;<a href="https://github.com/stephennancekivell/angular_e2e_http/tree/ngMockE2E">github.com/~~/angular_e2e_http/tree/ngMockE2E</a><br /><br /><br /><br />An Angular.js app has 3 main parts.<br />*&nbsp;&nbsp;html where&nbsp;additional&nbsp;markup is used to populate a template with data.<br />*&nbsp;The controller's which control the templates and the services.<br />*&nbsp;The services which get data from a rest backend via xhr requests.<br /><br />Testing angular apps can be done with unit tests and e2e tests. The unit tests are good for testing controllers and services but don't render the html. You need to be able to test the angular markup in the html because this is where the data is actually presented to the user, a mistake here and everything else is useless. A easy mistake here could be to miss type a ng-model.<br /><br />In the unit tests you can easily inject a mocked http backend to feed test data into the services.&nbsp;But you cant do this in the e2e tests the same way. I've gotten around this to test everything in the app.<br /><br />In my app we have a app.html which is the entry point to the app, it&nbsp;imports our javascript which then uses other template.html's to draw the screen. I've created a test version app.test.html to be used as a replacement in our e2e tests. App.test.html includes some extra javascript which sets a mocked the http backend for the app. This returns lets the e2e with static responses to our xhr requests.<br /><br />In my app we have a app.html which is the entry point to the app, it imports the javascript which then uses our template.html's to draw the screen. I've created a test version of app.html which includes a mocked http backend for the app. This mock includes the static responses for our xhr requests.<br /><br /><br />Heres an example.<br /><h4>app.test.html </h4><pre class="prettyprint lang-js">&amp;lt!-- for using mocked data while testing --&amp;gt<br />&amp;ltscript type="text/javascript" src="../test/lib/angular/angular-mocks.js"&amp;gt&amp;lt/script&amp;gt<br />&amp;ltscript type="text/javascript" src="../test/e2e/mocks.js"&amp;gt&amp;lt/script&amp;gt<br /></pre><h4>mocks.js </h4><pre class="prettyprint lang-js">App.config(function($provide){<br />  $provide.decorator('$httpBackend', angular.mock.e2e.$httpBackendDecorator);<br />});<br /><br />App.run(function($httpBackend){<br />  console.log('Setting up mocks');<br />  $httpBackend.whenGET('/rest/foo?query=bar').<br />    respond({"foo":"bar"});<br />});<br /></pre><h4>scenario.js </h4><pre class="prettyprint lang-js">describe('app', function() {<br />  beforeEach(function() {    browser().navigateTo('../../app/app.test.html');});<br />  it('should render the response', function() {<br />    expect(element('.bar').text().tobe('bar');<br />  });<br />});<br /></pre><br /><br />These are not complete end 2 end tests. A complete end 2 end test would run against a running backend. But my team have found that to be too much overhead for us. We know our test coverage is disjoint at the rest layer and are comfortable with that.<br /><br />Edit:<br />Heres a example project showing the technique https://github.com/stephennancekivell/angular_e2e_http