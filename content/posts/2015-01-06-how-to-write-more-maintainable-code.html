---
layout: post
title: How to write more maintainable code with the angular.js controller as syntax.
date: '2015-01-06T03:30:00.001-08:00'
author: Stephen Nancekivell
tags: 
modified_time: '2015-01-09T21:21:30.126-08:00'
blogger_id: tag:blogger.com,1999:blog-2519344180739427574.post-8386508412825769094
blogger_orig_url: http://blog.stephenn.com/2015/01/how-to-write-more-maintainable-code.html
---

<div><br /></div><div>The Angular.js team have added a new way to access variables within your controller. When I first saw this I glossed over it and missed the point thinking it was just shortcut syntax, more ways of doing the same thing, but its not. In this post I’ll explain why the controller as syntax is good and you should be using it.</div><div><br /></div><div><b>The angular controller</b> as syntax&nbsp;looks like this.. ng-controller=“MyController as ctrl1” with access like this..&nbsp;ng-click=“ctrl1.doit();”. This is an extension to the&nbsp;original way of ng-controller=“MyController” with ng-click=“doit()”.</div><div><br /></div><div>Whats good about&nbsp;the as syntax is you can reference variables directly without&nbsp;getting lost by any of the&nbsp;child scopes.</div><div>eg,</div><div><br /></div><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> &lt;div ng-controller=“MyController as ctrl1"&gt;  <br />    &lt;h1&gt;button number {{ "{{" }}clicked}} was clicked&lt;/h1&gt;  <br />    &lt;div ng-if=“true”&gt;  <br />      &lt;button ng-click=“clicked=1”&gt;1&lt;/button&gt;  <br />      &lt;button ng-click=“ctrl1.clicked=2”&gt;2&lt;/button&gt;  <br />    &lt;/div&gt;  <br /> &lt;/div&gt;  <br /></code></pre><div><br /></div><div><b>The trap</b> here is that ng-if creates a&nbsp;child scope from the scope of MyController. So the assignment in the template by ng-click&nbsp;can assign to the child scope instead of the one you actually want.&nbsp;ctrl1.clicked is always to the right one, it doesn’t matter how many ng-ifs you put around it. You can work around this without the as syntax by using $parent and the “dot rule”, but thats error prone. On a side note you should favour ng-show over ng-if, it doesn’t have this problem and is usually enough.</div><div><br /></div><div><b>Access from the controller</b> is a little bit different too. You now access the variables through the controllers `this` reference rather then the scope directly. The advantage here is that your not using the scope with its complexity of its hierarchy.</div><div><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> controller('OneCtrl', function(){  <br />  this.doit = function(){...};  <br /> });  <br /></code></pre><br /></div><div>If you really need the $scope&nbsp;you can still have it, just inject it like normal. But there maybe better solutions&nbsp;without it. If you were using the scope hierarchy to&nbsp;communicate between controllers&nbsp;consider event broadcasting, like $rootScope.$broadcast, this is more explicit, easier to test and less error prone. If you needed $scope.$apply, you must be doing something weird outside of the angular lifecycle, try moving that&nbsp;into a service&nbsp;or a directive.</div><div><br /></div><div>The angular as syntax can also help with <b>code reuse</b>. Imagine a image gallery controller it’ll have some &lt;img&gt; tags in the template which won’t be shareable&nbsp;but shared logic will be in the controller. You may even want to use different templates in the different places its used. By accessing the controller with the as&nbsp;syntax its safe and simple to use along side other model controllers.</div><div>A common gallery could be done with a directive, but if your not actually need access to the DOM, a utility controller&nbsp;would be the simpler way to go.</div><div><br /></div><div>Unit <b>testing</b> has some slight changes too, you save a reference to the controller instance and access your variables through that.</div><div><br /></div><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> describe('testing controllers with angular as syntax', function(){  <br />  angular.module('module', []).  <br />   controller('OneCtrl', function(){  <br />    this.name = 'One';  <br />   });  <br />   <br />  beforeEach(module('module'));  <br />   <br />  it('initializes and can get the value', inject(function($controller){  <br />   <br />   var ctrl = $controller('OneCtrl', {});  <br />   <br />   expect(ctrl.name).toBe('One');  <br />  }));  <br /> });  <br /></code></pre><div><br /></div><div><br /><b>Consider how the As syntax has been made</b>. Its really simple, it just assigns the controller to a value in the scope. Understanding this and be confident that angular.js Isn't magic and that this can work happily along side other code.<br /><br /><b>Be careful with the `this`</b> reference. Remember in javascript the `this` reference changes. Look out for traps like this.<br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> controller('SomeCtrl', function(){  <br />  var self = this;  <br />  this.name = 'One';  <br />  this.obj = {  <br />   name: 'two',  <br />   returnName: function(){  <br />    return this.name; // returns 'two' not 'One'  <br />  }<br /> };  <br /></code></pre><br /><br />So thats how to write more maintainable code using the angular js controller as syntax. If you think I’ve left anything out let me know.</div><div><br /></div><span id="goog_210269854"></span><span id="goog_210269855"></span><a href="https://www.blogger.com/"></a><br /><div>Code long and prosper.<br /><br /><br /><b>Related Posts</b><br /><ul><li><b><a href="http://blog.stephenn.com/2012/09/e2e-testing-in-angularjs.html">e2e testing in angular.js with a mocked httpBackend</a></b></li><li><a href="http://blog.stephenn.com/2014/04/review-making-your-own-angularjs.html">Review making your own angularjs</a></li><li><a href="http://blog.stephenn.com/2014/03/javascript-apps-and-rendering-big-lists.html">Javascript apps and rendering big lists</a></li></ul><div><a href="https://twitter.com/StephenNancekiv">Follow me on twitter.</a></div></div>